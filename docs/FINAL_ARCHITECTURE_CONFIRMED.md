# THERMOTECH-OPS 完整架構設計（用戶確認版）

## 🎯 核心架構

### 統一首頁（所有角色共用）

```
┌─────────────────────────────────────────────────────────────┐
│ THERMOTECH-OPS          USER: 張庭憲 | 廠務部 | POINTS: 1250│
├─────────────────────────────────────────────────────────────┤
│                                                               │
│  ┌───────────────── 行事曆 (Calendar) ──────────────────┐   │
│  │                                                         │   │
│  │  2025年11月                                             │   │
│  │  ┌──┬──┬──┬──┬──┬──┬──┐                            │   │
│  │  │一│二│三│四│五│六│日│                            │   │
│  │  ├──┼──┼──┼──┼──┼──┼──┤                            │   │
│  │  │  │  │  │6 │  │  │  │                            │   │
│  │  │  │  │  │丟│  │  │  │  ← 每週四顯示"丟垃圾"     │   │
│  │  │  │  │  │垃│  │  │  │                            │   │
│  │  │  │  │  │圾│  │  │  │                            │   │
│  │  ├──┼──┼──┼──┼──┼──┼──┤                            │   │
│  │  │  │  │  │13│  │  │  │                            │   │
│  │  │  │  │  │丟│  │  │  │                            │   │
│  │  │  │  │  │垃│  │  │  │                            │   │
│  │  │  │  │  │圾│  │  │  │                            │   │
│  │  └──┴──┴──┴──┴──┴──┴──┘                            │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                               │
│  ┌─ 例行公事 ───────┐ ┌─ 交辦事項 ───────┐               │
│  │                   │ │                   │               │
│  │ □ 週四丟垃圾      │ │ □ 整理316文件     │               │
│  │ □ 每月6號匯款     │ │ □ 協助主管報表    │               │
│  │ □ 每日巡檢機台    │ │ □ 參加週五會議    │               │
│  └───────────────────┘ └───────────────────┘               │
│                                                               │
│  ┌─ 公共事項 ───────┐ ┌─ 公告欄 ─────────┐               │
│  │                   │ │                   │               │
│  │ 11/22 垃圾車收運  │ │ [NEW] 本週五消防  │               │
│  │ 11/28 公司尾牙    │ │       演練通知    │               │
│  │ 12/07 員工體檢    │ │                   │               │
│  │ 12/25 國定假日    │ │ 上週完成率 85%    │               │
│  └───────────────────┘ └───────────────────┘               │
└─────────────────────────────────────────────────────────────┘
```

**關鍵點**：
1. 行事曆會自動顯示所有事項（例行公事、交辦、公共事項）
2. 下方四個區塊清楚分類
3. 所有人看到的結構一樣

---

## 🔐 權限差異設計

### 一般同事登入
```
首頁（上述設計）
  - 只能看到自己的事項
  - 只能完成自己的任務
```

### Admin 登入
```
首頁（上述設計 + 額外功能）
  - 看到所有人的概況
  - 頂部多了【分頁按鈕】：
    ┌────────────────────────────────────────────────┐
    │ [首頁] [人事] [廠務] [業務] [報表] [系統設定]  │
    └────────────────────────────────────────────────┘
  - 可以新增交辦事項
  - 可以發布公告
```

---

## 📄 部門專屬頁面

### 1. 人事頁面（HR Module）

#### 功能選單
```
┌─────────────────────────────────────────────┐
│ 人事管理                                     │
├─────────────────────────────────────────────┤
│                                              │
│  [通知管理] [外籍勞工] [員工檔案] [考勤]    │
│                                              │
└─────────────────────────────────────────────┘
```

#### 1.1 通知管理
```
┌────────────────────────────────────────────────┐
│ Line 通知推播                                   │
├────────────────────────────────────────────────┤
│                                                 │
│  選擇對象：                                     │
│  ☐ 全公司                                       │
│  ☐ 依廠區選擇: [ ] 316 [ ] 310 [ ] 高獅       │
│  ☐ 依部門選擇: [ ] 廠務 [ ] 管理 [ ] 業務     │
│  ☐ 手動選擇:                                    │
│     [ ] 張庭憲 [ ] 潘育昌 [ ] 林珠華 ...       │
│                                                 │
│  訊息範本: [▼]                                  │
│    - 薪資通知                                   │
│    - 假日公告                                   │
│    - 體檢通知                                   │
│    - 自訂訊息                                   │
│                                                 │
│  訊息內容:                                      │
│  ┌──────────────────────────────────────┐      │
│  │                                        │      │
│  │                                        │      │
│  └──────────────────────────────────────┘      │
│                                                 │
│  [預覽] [立即發送] [排程發送]                  │
└────────────────────────────────────────────────┘
```

#### 1.2 外籍勞工管理
```
┌────────────────────────────────────────────────┐
│ 外籍勞工檔案管理                                │
├────────────────────────────────────────────────┤
│                                                 │
│  員工列表:                                      │
│  ┌──────────────────────────────────────┐      │
│  │姓名    │國籍│證件到期│狀態│操作      │      │
│  │阮慧喬  │越南│2025/12 │[警告]│[查看]│      │
│  │武氏燕  │越南│2026/03 │正常  │[查看]│      │
│  │阮氏河  │越南│2025/11 │[逾期]│[查看]│      │
│  └──────────────────────────────────────┘      │
│                                                 │
│  詳細資訊:                                      │
│  - 護照掃描檔                                   │
│  - 居留證掃描檔                                 │
│  - 工作許可證                                   │
│  - 健康檢查記錄                                 │
│  - 到期自動提醒（提前30天）                    │
│                                                 │
│  [新增人員] [匯出報表] [批次更新]             │
└────────────────────────────────────────────────┘
```

### 2. 廠務頁面（Operations Module）
```
功能：
- 設備保養排程
- 報修記錄查詢
- 材料庫存管理
- 安全檢查記錄
```

### 3. 業務頁面（Sales Module）
```
功能：
- 訂單追蹤
- 客戶管理
- 報價管理
```

---

## 🗂️ 資料結構更新

### 新增資料表

#### 1. 行事曆事項（calendar_events）
```sql
CREATE TABLE calendar_events (
  id BIGINT PRIMARY KEY,
  title TEXT,                    -- 事項標題
  event_type TEXT,               -- 'routine', 'assignment', 'public', 'announcement'
  event_date DATE,               -- 事項日期
  user_id UUID,                  -- 相關人員（NULL = 全公司）
  recurrence_rule TEXT,          -- 重複規則 (如 'weekly:thursday')
  created_by UUID,               -- 建立者
  created_at TIMESTAMPTZ
);
```

#### 2. 公共事項（public_events）
```sql
CREATE TABLE public_events (
  id BIGINT PRIMARY KEY,
  title TEXT,                    -- 標題（如：垃圾車收運）
  event_date DATE,               -- 日期
  event_type TEXT,               -- 'holiday', 'company', 'service', 'other'
  description TEXT,              -- 說明
  is_active BOOLEAN DEFAULT TRUE
);
```

#### 3. 公告（announcements）
```sql
CREATE TABLE announcements (
  id BIGINT PRIMARY KEY,
  title TEXT,
  content TEXT,
  posted_by UUID,
  posted_at TIMESTAMPTZ,
  target_users TEXT[],           -- 目標對象（NULL = 全公司）
  is_read_by UUID[],             -- 已讀名單
  priority TEXT DEFAULT 'normal' -- 'high', 'normal', 'low'
);
```

#### 4. 文件管理（documents）
```sql
CREATE TABLE documents (
  id BIGINT PRIMARY KEY,
  file_name TEXT,
  file_url TEXT,                 -- Supabase Storage URL
  category TEXT,                 -- 'hr', 'operations', 'foreign_worker', etc
  related_user_id UUID,          -- 相關人員
  uploaded_by UUID,
  uploaded_at TIMESTAMPTZ,
  expiry_date DATE,              -- 到期日（如證件）
  notes TEXT
);
```

---

## 🔄 開發優先順序

### 階段 1：首頁行事曆（立即開始）
1. 建立行事曆元件（顯示當月）
2. 整合例行公事資料（從 task_definitions 讀取）
3. 顯示週期性事項（週四、每月6號等）

### 階段 2：四個區塊
1. 例行公事清單（from task_definitions）
2. 交辦事項清單（from daily_assignments）
3. 公共事項清單（from public_events）
4. 公告欄（from announcements）

### 階段 3：Admin 功能
1. 頂部分頁按鈕
2. 新增交辦功能
3. 發布公告功能

### 階段 4：部門專屬頁面
1. 人事 - 通知管理
2. 人事 - 外籍勞工管理
3. 其他部門頁面

---

## ❓ 需要確認的問題

### 1. 行事曆的顯示邏輯
**例行公事**：
- "週四丟垃圾" → 自動顯示在每個週四？
- "每月6號匯款" → 自動顯示在每月6號？
- 這些規則儲存在哪裡？（task_definitions 的 frequency 欄位？）

### 2. 權限清單
請提供**每個角色可以訪問的分頁**：

| 角色 | 可訪問分頁 |
|------|-----------|
| 一般同事 | 首頁 |
| 組長 | 首頁、? |
| 廠長 | 首頁、廠務、? |
| 人事 | 首頁、人事 |
| Admin | 全部 |

### 3. 公共事項的來源
- 垃圾車、國定假日、公司活動 → 誰負責建立？
- 是否需要「公共事項管理」頁面？

### 4. 外籍勞工清單
您有幾位外籍勞工？需要我從現有的 21 位員工中識別出來嗎？

---

## 🚀 我的建議

**立即開始開發**：

1. **首頁行事曆**（2小時）
   - 建立月曆元件
   - 整合例行公事資料
   - 顯示週期性規則

2. **四個區塊**（1小時）
   - 簡單的列表展示
   - 使用 Mock 資料

3. **權限系統**（30分鐘）
   - Admin 頂部分頁按鈕
   - 根據角色顯示/隱藏

---

**請確認以上理解是否正確，我將立即開始開發首頁行事曆！** 🚀


